<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø£Ù‚Ø±Ø¨ Ù…Ø¯Ø±Ø³Ø© Ø³ÙŠØ§Ù‚Ø© | Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø³ÙŠØ§Ù‚Ø© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©</title>
  <!-- Font Awesome 6 -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <!-- Leaflet (OpenStreetMap) -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <!-- Google Fonts: Cairo -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Cairo', sans-serif;
      background-color: #f9fafc;
      color: #1e293b;
      line-height: 1.6;
    }

    a {
      text-decoration: none;
      color: inherit;
    }

    .container {
      width: 90%;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* header (Ù…Ø·Ø§Ø¨Ù‚ Ù„Ù„ØµÙØ­Ø§Øª Ø§Ù„Ø³Ø§Ø¨Ù‚Ø©) */
    .header {
      background-color: #ffffff;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      position: sticky;
      top: 0;
      z-index: 1000;
      transition: all 0.3s ease;
    }

    .header .container {
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      padding: 1rem 0;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 1.5rem;
      font-weight: 700;
      color: #0f3b5e;
    }

    .logo i {
      color: #f5b041;
      font-size: 2rem;
    }

    .nav-menu {
      display: flex;
      gap: 1.5rem;
      font-weight: 600;
    }

    .nav-menu a {
      padding: 0.5rem 0;
      position: relative;
      transition: color 0.3s;
    }

    .nav-menu a:hover {
      color: #0f3b5e;
    }

    .nav-menu a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0%;
      height: 2px;
      background-color: #f5b041;
      transition: width 0.3s;
    }

    .nav-menu a:hover::after {
      width: 100%;
    }

    .contact-btn {
      background-color: #0f3b5e;
      color: white !important;
      padding: 0.5rem 1.2rem;
      border-radius: 30px;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      transition: background-color 0.3s, transform 0.2s;
    }

    .contact-btn:hover {
      background-color: #1e4f73;
      transform: scale(1.05);
    }

    /* Ø±Ø£Ø³ ÙØ±Ø¹ÙŠ */
    .page-header {
      background: linear-gradient(135deg, #0f3b5e 0%, #1b4d75 100%);
      color: white;
      padding: 3rem 0;
      text-align: center;
      margin-bottom: 2rem;
    }

    .page-header h1 {
      font-size: 2.8rem;
      margin-bottom: 0.5rem;
    }

    .page-header p {
      font-size: 1.2rem;
      opacity: 0.9;
    }

    /* Ø´Ø±ÙŠØ· Ø§Ù„ØªØ­ÙƒÙ… */
    .search-section {
      background: white;
      border-radius: 60px;
      padding: 0.8rem 1.5rem;
      box-shadow: 0 10px 25px rgba(0,20,40,0.08);
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
      margin-bottom: 2rem;
    }

    .location-btn {
      background: #f5b041;
      color: #0f3b5e;
      border: none;
      padding: 0.8rem 2rem;
      border-radius: 40px;
      font-weight: 600;
      font-size: 1.1rem;
      cursor: pointer;
      transition: background 0.3s, transform 0.2s;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .location-btn:hover {
      background: #f39c12;
      transform: scale(1.05);
    }

    .search-box {
      display: flex;
      align-items: center;
      flex: 1;
      min-width: 250px;
      background: #f1f5f9;
      border-radius: 40px;
      padding: 0.3rem 1rem;
    }

    .search-box i {
      color: #94a3b8;
      font-size: 1.2rem;
    }

    .search-box input {
      border: none;
      background: transparent;
      padding: 0.8rem 0.5rem;
      width: 100%;
      font-family: 'Cairo', sans-serif;
      font-size: 1rem;
    }

    .search-box input:focus {
      outline: none;
    }

    .filter-btn {
      background: #eef2f6;
      border: none;
      width: 50px;
      height: 50px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.3rem;
      color: #0f3b5e;
      cursor: pointer;
      transition: background 0.3s;
    }

    .filter-btn:hover {
      background: #f5b041;
    }

    /* Ø´Ø¨ÙƒØ© Ø§Ù„Ø®Ø±ÙŠØ·Ø© ÙˆØ§Ù„Ù‚Ø§Ø¦Ù…Ø© */
    .schools-map-container {
      display: grid;
      grid-template-columns: 1.1fr 1.9fr;
      gap: 1.5rem;
      margin-bottom: 3rem;
    }

    /* Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© */
    .schools-list {
      background: white;
      border-radius: 40px;
      padding: 1.5rem;
      box-shadow: 0 15px 30px rgba(0,20,40,0.05);
      max-height: 650px;
      overflow-y: auto;
    }

    .list-title {
      font-size: 1.5rem;
      color: #0f3b5e;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
      position: sticky;
      top: 0;
      background: white;
      padding-bottom: 0.5rem;
      z-index: 10;
    }

    .school-card {
      background: #f8fafc;
      border-radius: 30px;
      padding: 1.2rem;
      margin-bottom: 1rem;
      transition: all 0.3s;
      border-right: 4px solid transparent;
      position: relative;
    }

    .school-card:hover {
      transform: translateX(-5px);
      border-right-color: #f5b041;
      box-shadow: 0 8px 16px rgba(0,0,0,0.05);
    }

    .school-card.nearest {
      background: #fff8e7;
      border-right: 4px solid #f5b041;
      box-shadow: 0 0 0 2px #f5b04133;
    }

    .badge-nearest {
      position: absolute;
      top: 10px;
      left: 10px;
      background: #f5b041;
      color: #0f3b5e;
      font-size: 0.75rem;
      font-weight: 700;
      padding: 0.25rem 0.75rem;
      border-radius: 30px;
    }

    .school-name {
      font-size: 1.3rem;
      font-weight: 700;
      color: #0f3b5e;
      margin-bottom: 0.15rem;
    }

    .instructor {
      font-size: 0.9rem;
      color: #f5b041;
      margin-bottom: 0.5rem;
      font-weight: 500;
    }

    .school-address {
      color: #4b5563;
      font-size: 0.95rem;
      margin-bottom: 0.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .meta-row {
      display: flex;
      flex-wrap: wrap;
      gap: 0.8rem;
      margin: 0.75rem 0;
    }

    .phone-number {
      background: #e2e8f0;
      padding: 0.25rem 1rem;
      border-radius: 40px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 0.4rem;
      direction: ltr;
    }

    .work-hours {
      background: #0f3b5e;
      color: white;
      padding: 0.25rem 1rem;
      border-radius: 40px;
      font-size: 0.8rem;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }

    .distance {
      background: #f5b041;
      color: #0f3b5e;
      padding: 0.3rem 1rem;
      border-radius: 40px;
      font-size: 0.9rem;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
    }

    .direction-btn {
      background: transparent;
      border: 2px solid #f5b041;
      color: #f5b041;
      padding: 0.4rem 1.2rem;
      border-radius: 40px;
      font-weight: 600;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .direction-btn:hover {
      background: #f5b041;
      color: #0f3b5e;
    }

    /* Ø§Ù„Ø®Ø±ÙŠØ·Ø© */
    .map-wrapper {
      background: white;
      border-radius: 40px;
      padding: 1.2rem;
      box-shadow: 0 15px 30px rgba(0,20,40,0.05);
      display: flex;
      flex-direction: column;
    }

    .map-title {
      font-size: 1.2rem;
      color: #0f3b5e;
      margin-bottom: 0.8rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    #map {
      width: 100%;
      height: 550px;
      border-radius: 30px;
      z-index: 1;
    }

    .coords-bar {
      background: #f1f5f9;
      padding: 0.5rem 1rem;
      border-radius: 60px;
      margin-top: 1rem;
      font-size: 0.9rem;
      color: #0f3b5e;
      text-align: center;
    }

    /* ØªØ°ÙŠÙŠÙ„ */
    .footer {
      background-color: #0f3b5e;
      color: #e2e8f0;
      padding: 3rem 0 2rem;
      border-top: 5px solid #f5b041;
      margin-top: 4rem;
    }

    .footer-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 2.5rem;
    }

    .footer-col h3 {
      color: white;
      font-size: 1.4rem;
      margin-bottom: 1.2rem;
      position: relative;
      padding-bottom: 0.5rem;
    }

    .footer-col h3::after {
      content: '';
      position: absolute;
      bottom: 0;
      right: 0;
      width: 60px;
      height: 3px;
      background-color: #f5b041;
    }

    .footer-col p {
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      gap: 0.7rem;
    }

    .social-links {
      display: flex;
      gap: 1.2rem;
      margin-top: 1rem;
    }

    .social-links a {
      background-color: rgba(255,255,255,0.1);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.3s, transform 0.2s;
    }

    .social-links a:hover {
      background-color: #f5b041;
      color: #0f3b5e;
    }

    .copyright {
      text-align: center;
      margin-top: 3rem;
      padding-top: 1.5rem;
      border-top: 1px solid #295a7a;
    }

    @media (max-width: 992px) {
      .schools-map-container {
        grid-template-columns: 1fr;
      }
      .footer-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 768px) {
      .header .container {
        flex-direction: column;
        gap: 1rem;
      }
      .page-header h1 { font-size: 2.2rem; }
      .footer-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <header class="header">
    <div class="container">
      <div class="logo"><i class="fas fa-car-side"></i><span>Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø³ÙŠØ§Ù‚Ø© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©</span></div>
      <nav class="nav-menu">
        <a href="#">Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©</a>
        <a href="#">Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±</a>
        <a href="#">Ù‚ÙˆØ§Ù†ÙŠÙ† Ø§Ù„Ø³ÙŠØ§Ù‚Ø©</a>
        <a href="#">Ù†ØµØ§Ø¦Ø­ Ø§Ù„Ø£Ù…Ø§Ù†</a>
        <a href="#">Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª</a>
      </nav>
      <a href="#" class="contact-btn"><i class="fas fa-phone-alt"></i> Ø§ØªØµÙ„ Ø¨Ù†Ø§</a>
    </div>
  </header>

  <section class="page-header">
    <div class="container">
      <h1>Ø§Ø¨Ø­Ø« Ø¹Ù† Ø£Ù‚Ø±Ø¨ Ù…Ø¯Ø±Ø³Ø© Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø³ÙŠØ§Ù‚Ø©</h1>
      <p>Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ù„ØªØ±Ù‰ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ù‚Ø±ÙŠØ¨Ø© Ù…Ù†Ùƒ Ù…Ø¹ Ø§Ù„Ù…Ø³Ø§ÙØ© ÙˆØ¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„</p>
    </div>
  </section>

  <div class="container">
    <div class="search-section">
      <button class="location-btn" id="useLocationBtn"><i class="fas fa-location-dot"></i> Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹ÙŠ</button>
      <div class="search-box">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Ø§Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ù…Ø¯Ø±Ø³Ø© Ø£Ùˆ Ø§Ù„Ù…Ø¹Ù„Ù… Ø£Ùˆ Ø§Ù„Ø¨Ù„Ø¯ÙŠØ©..." id="searchInput">
      </div>
      <button class="filter-btn"><i class="fas fa-sliders-h"></i></button>
    </div>

    <div class="schools-map-container">
      <!-- Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠØ© -->
      <div class="schools-list">
        <h2 class="list-title"><i class="fas fa-school" style="color:#f5b041;"></i> Ø§Ù„Ù…Ø¯Ø§Ø±Ø³ Ø­Ø³Ø¨ Ø§Ù„Ø£Ù‚Ø±Ø¨</h2>
        <div id="schoolsContainer"></div>
      </div>

      <!-- Ø§Ù„Ø®Ø±ÙŠØ·Ø© -->
      <div class="map-wrapper">
        <h3 class="map-title"><i class="fas fa-map-marked-alt" style="color:#f5b041;"></i> Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ø§Ù„ØªÙØ§Ø¹Ù„ÙŠØ©</h3>
        <div id="map"></div>
        <div class="coords-bar" id="coordsDisplay">
          <i class="fas fa-satellite-dish"></i> Ø§Ù†ØªØ¸Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹...
        </div>
      </div>
    </div>
  </div>

  <footer class="footer">
    <div class="container">
      <div class="footer-grid">
        <div class="footer-col"><h3>Ø¹Ù† Ø§Ù„Ù…ÙˆÙ‚Ø¹</h3><p><i class="fas fa-flag-checkered"></i> Ø£ÙˆÙ„ Ù…Ù†ØµØ© Ø¬Ø²Ø§Ø¦Ø±ÙŠØ© Ù…ØªÙƒØ§Ù…Ù„Ø© Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø³ÙŠØ§Ù‚Ø©.</p><p><i class="fas fa-map-pin"></i> Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± - Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙˆÙ„Ø§ÙŠØ§Øª</p></div>
        <div class="footer-col"><h3>Ø±ÙˆØ§Ø¨Ø· Ù…ÙÙŠØ¯Ø©</h3><ul class="footer-links"><li><a href="#"><i class="fas fa-chevron-left"></i> Ø¥Ø´Ø§Ø±Ø§Øª Ø§Ù„Ù…Ø±ÙˆØ±</a></li><li><a href="#"><i class="fas fa-chevron-left"></i> Ù‚Ø§Ù†ÙˆÙ† Ø§Ù„Ù…Ø±ÙˆØ±</a></li></ul></div>
        <div class="footer-col"><h3>ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§</h3><p><i class="fas fa-phone"></i> 0550 12 34 56</p><div class="social-links"><a href="#"><i class="fab fa-facebook-f"></i></a><a href="#"><i class="fab fa-youtube"></i></a></div></div>
      </div>
      <div class="copyright">&copy; 2025 Ù…Ø¯Ø§Ø±Ø³ Ø§Ù„Ø³ÙŠØ§Ù‚Ø© Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠØ©</div>
    </div>
  </footer>

  <script>
    (function() {
      // ---------- Ø¨ÙŠØ§Ù†Ø§Øª Ù…ÙˆØ³Ø¹Ø© Ù„Ù„Ù…Ø¯Ø§Ø±Ø³ (Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±) ----------
      const schools = [
        {
          id: 1,
          teacherFname: 'Ù…Ø­Ù…Ø¯',
          teacherLname: 'Ø¨ÙˆØ¹Ø²ÙŠØ²',
          municipality: 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„ÙˆØ³Ø·Ù‰',
          wilaya: 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±',
          phone: '0550 12 12 12',
          lat: 36.775,
          lng: 3.060,
          hours: '8:00-18:00'
        },
        {
          id: 2,
          teacherFname: 'ÙØ§Ø·Ù…Ø©',
          teacherLname: 'Ø²Ø±ÙˆØ§Ù„ÙŠ',
          municipality: 'Ø­Ø³ÙŠÙ† Ø¯Ø§ÙŠ',
          wilaya: 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±',
          phone: '0551 34 34 34',
          lat: 36.760,
          lng: 3.090,
          hours: '9:00-19:00'
        },
        {
          id: 3,
          teacherFname: 'ÙƒØ±ÙŠÙ…',
          teacherLname: 'Ø¨ÙˆØ¬Ù…Ø¹Ø©',
          municipality: 'Ø¨Ø§Ø¨ Ø§Ù„Ø²ÙˆØ§Ø±',
          wilaya: 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±',
          phone: '0552 56 78 90',
          lat: 36.730,
          lng: 3.120,
          hours: '8:30-17:30'
        },
        {
          id: 4,
          teacherFname: 'Ù†Ø³ÙŠÙ…Ø©',
          teacherLname: 'Ø­Ù…Ø§Ù†ÙŠ',
          municipality: 'Ø§Ù„Ù‚Ø¨Ø©',
          wilaya: 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±',
          phone: '0553 98 76 54',
          lat: 36.740,
          lng: 3.045,
          hours: '8:00-17:00'
        },
        {
          id: 5,
          teacherFname: 'Ø¹Ø¨Ø¯ Ø§Ù„Ø±Ø­Ù…Ø§Ù†',
          teacherLname: 'Ø¨Ù† Ø¹ÙˆØ¯Ø©',
          municipality: 'Ø¨ÙˆØ²Ø±ÙŠØ¹Ø©',
          wilaya: 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±',
          phone: '0554 67 89 01',
          lat: 36.785,
          lng: 3.015,
          hours: '9:00-20:00'
        },
        {
          id: 6,
          teacherFname: 'Ø³Ù…ÙŠØ±Ø©',
          teacherLname: 'Ù‚Ø§Ø¯Ø±ÙŠ',
          municipality: 'Ø§Ù„Ø­Ø±Ø§Ø´',
          wilaya: 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±',
          phone: '0555 12 34 56',
          lat: 36.725,
          lng: 3.135,
          hours: '8:00-16:00'
        },
        {
          id: 7,
          teacherFname: 'Ø¹Ù„ÙŠ',
          teacherLname: 'Ù…ØµØ·ÙÙ‰',
          municipality: 'Ø¯Ø±Ø§Ø±ÙŠØ©',
          wilaya: 'Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±',
          phone: '0556 78 90 12',
          lat: 36.710,
          lng: 2.990,
          hours: '8:30-18:30'
        }
      ];

      // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
      let userLocation = null; // { lat, lng }
      let map = null;
      let markersLayer = L.layerGroup().addTo(map); // Ø³ØªØ¶Ø§Ù Ø¨Ø¹Ø¯ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø©
      let allMarkers = [];

      // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
      function haversineDistance(lat1, lon1, lat2, lon2) {
        const R = 6371; // km
        const dLat = (lat2 - lat1) * Math.PI / 180;
        const dLon = (lon2 - lon1) * Math.PI / 180;
        const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                  Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                  Math.sin(dLon/2) * Math.sin(dLon/2);
        const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
        return R * c;
      }

      // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ§Øª ÙˆØ¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ distance
      function computeDistances() {
        if (!userLocation) return schools.map(s => ({ ...s, distance: null }));
        return schools.map(s => {
          const dist = haversineDistance(userLocation.lat, userLocation.lng, s.lat, s.lng);
          return { ...s, distance: Math.round(dist * 10) / 10 };
        });
      }

      // ØªØ±ØªÙŠØ¨ Ø­Ø³Ø¨ Ø§Ù„Ù…Ø³Ø§ÙØ© (Ø§Ù„Ø£Ù‚Ø±Ø¨ Ø£ÙˆÙ„Ø§Ù‹)
      function getSortedSchools() {
        let withDist = computeDistances();
        return withDist.sort((a, b) => {
          if (a.distance === null) return 1;
          if (b.distance === null) return -1;
          return a.distance - b.distance;
        });
      }

      // Ø¹Ø±Ø¶ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª
      function renderSchoolsList() {
        const container = document.getElementById('schoolsContainer');
        const sorted = getSortedSchools();
        let html = '';
        sorted.forEach((s, idx) => {
          const nearestClass = idx === 0 && userLocation ? 'nearest' : '';
          const badge = (idx === 0 && userLocation) ? '<span class="badge-nearest"><i class="fas fa-crown"></i> Ø§Ù„Ø£Ù‚Ø±Ø¨</span>' : '';
          const distText = s.distance ? `${s.distance} ÙƒÙ…` : '--';
          html += `
            <div class="school-card ${nearestClass}" data-id="${s.id}">
              ${badge}
              <div class="school-name">${s.teacherFname} ${s.teacherLname}</div>
              <div class="instructor"><i class="fas fa-chalkboard-teacher"></i> Ù…Ø¹Ù„Ù… Ø§Ù„Ø³ÙŠØ§Ù‚Ø©</div>
              <div class="school-address"><i class="fas fa-map-pin"></i> ${s.municipality}ØŒ ${s.wilaya}</div>
              <div class="meta-row">
                <span class="phone-number"><i class="fas fa-phone"></i> ${s.phone}</span>
                <span class="work-hours"><i class="far fa-clock"></i> ${s.hours}</span>
              </div>
              <div class="meta-row">
                <span class="distance"><i class="fas fa-road"></i> ${distText}</span>
              </div>
              <button class="direction-btn" data-lat="${s.lat}" data-lng="${s.lng}" data-name="${s.teacherFname} ${s.teacherLname}">
                <i class="fas fa-route"></i> Ø§Ù„Ù…Ø³Ø§Ø±
              </button>
            </div>
          `;
        });
        container.innerHTML = html;

        // Ø¥Ø¶Ø§ÙØ© Ø£Ø­Ø¯Ø§Ø« Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ù…Ø³Ø§Ø±
        document.querySelectorAll('.direction-btn').forEach(btn => {
          btn.addEventListener('click', (e) => {
            e.stopPropagation();
            const lat = btn.dataset.lat;
            const lng = btn.dataset.lng;
            const name = btn.dataset.name;
            if (!userLocation) {
              alert('Ø§Ù„Ø±Ø¬Ø§Ø¡ ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ Ø£ÙˆÙ„Ø§Ù‹ Ø¹Ø¨Ø± Ø²Ø± "Ø­Ø¯Ø¯ Ù…ÙˆÙ‚Ø¹ÙŠ"');
              return;
            }
            // ÙØªØ­ OSRM (ØªÙˆØ¬ÙŠÙ‡)
            const url = `https://routing.openstreetmap.de/?loc=${userLocation.lat},${userLocation.lng}&loc=${lat},${lng}`;
            window.open(url, '_blank');
          });
        });
      }

      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø§Ø±ÙƒØ±Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø®Ø±ÙŠØ·Ø©
      function updateMarkers() {
        if (!map) return;
        if (markersLayer) markersLayer.clearLayers();

        const schoolsWithDist = computeDistances();
        const sorted = schoolsWithDist.sort((a,b) => (a.distance || 999) - (b.distance || 999));

        // Ø£ÙŠÙ‚ÙˆÙ†Ø© Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ø¯Ø±Ø³Ø© Ø§Ù„Ø£Ù‚Ø±Ø¨
        const nearestId = sorted.length > 0 && userLocation ? sorted[0].id : null;

        schools.forEach(school => {
          const isNearest = (school.id === nearestId);
          // Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©
          const iconUrl = isNearest 
            ? 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png'
            : 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-icon-2x.png';
          const iconSize = isNearest ? [30, 45] : [25, 41];

          const marker = L.marker([school.lat, school.lng], {
            icon: L.icon({
              iconUrl: iconUrl,
              shadowUrl: 'https://unpkg.com/leaflet@1.9.4/dist/images/marker-shadow.png',
              iconSize: iconSize,
              iconAnchor: [12, 41],
              popupAnchor: [1, -34],
              shadowSize: [41, 41]
            }),
            title: `${school.teacherFname} ${school.teacherLname}`
          }).bindPopup(`
            <b>${school.teacherFname} ${school.teacherLname}</b><br>
            ğŸ“ ${school.municipality}<br>
            ğŸ“ ${school.phone}<br>
            ğŸ•’ ${school.hours}<br>
            ${school.distance ? `<span style="color:#f5b041;">ğŸš— ${school.distance} ÙƒÙ…</span>` : ''}
          `);

          marker.addTo(markersLayer);
          allMarkers.push(marker);
        });

        // Ø¶Ø¨Ø· Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø®Ø±ÙŠØ·Ø© Ù„ØªØ´Ù…Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¯Ø§Ø±Ø³
        if (schools.length > 0) {
          const bounds = L.latLngBounds(schools.map(s => [s.lat, s.lng]));
          if (userLocation) bounds.extend([userLocation.lat, userLocation.lng]);
          map.fitBounds(bounds, { padding: [50, 50] });
        }
      }

      // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ø®Ø±ÙŠØ·Ø©
      function initMap(lat = 36.775, lng = 3.060) {
        if (map) return;
        map = L.map('map').setView([lat, lng], 12);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);
        markersLayer = L.layerGroup().addTo(map);

        // Ø¥Ø¶Ø§ÙØ© Ø¯Ø§Ø¦Ø±Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹ (Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ«)
      }

      // ØªØ­Ø¯ÙŠØ« Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      function setUserLocation(lat, lng) {
        userLocation = { lat, lng };
        document.getElementById('coordsDisplay').innerHTML = `<i class="fas fa-location-dot"></i> Ù…ÙˆÙ‚Ø¹Ùƒ: ${lat.toFixed(4)}, ${lng.toFixed(4)}`;

        // Ø­Ø°Ù Ø¯Ø§Ø¦Ø±Ø© Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ø¥Ù† ÙˆØ¬Ø¯Øª
        map.eachLayer(layer => {
          if (layer instanceof L.CircleMarker && layer.options.color === '#f5b041') {
            map.removeLayer(layer);
          }
        });
        // Ø±Ø³Ù… Ø¯Ø§Ø¦Ø±Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø­Ø§Ù„ÙŠ
        L.circleMarker([lat, lng], {
          radius: 10,
          color: '#f5b041',
          weight: 3,
          fillColor: '#fff',
          fillOpacity: 0.8
        }).addTo(map).bindPopup('Ù…ÙˆÙ‚Ø¹Ùƒ Ø§Ù„Ø­Ø§Ù„ÙŠ').openPopup();

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨Ø·Ø§Ù‚Ø§Øª ÙˆØ§Ù„Ù…Ø§Ø±ÙƒØ±Ø§Øª
        renderSchoolsList();
        updateMarkers();
      }

      // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø¹Ø¨Ø± Ø§Ù„Ù…ØªØµÙØ­
      function locateUser() {
        if (!navigator.geolocation) {
          alert('Ø§Ù„Ù…ØªØµÙØ­ Ù„Ø§ ÙŠØ¯Ø¹Ù… ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹');
          return;
        }
        navigator.geolocation.getCurrentPosition(
          (pos) => {
            const { latitude, longitude } = pos.coords;
            setUserLocation(latitude, longitude);
          },
          (err) => {
            alert('ØªØ¹Ø°Ø± ØªØ­Ø¯ÙŠØ¯ Ù…ÙˆÙ‚Ø¹Ùƒ. Ø³ÙŠØªÙ… Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙˆÙ‚Ø¹ Ø§ÙØªØ±Ø§Ø¶ÙŠ (Ø§Ù„Ø¬Ø²Ø§Ø¦Ø± Ø§Ù„Ø¹Ø§ØµÙ…Ø©)');
            setUserLocation(36.775, 3.060);
          }
        );
      }

      // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ø­ÙŠ
      document.getElementById('searchInput').addEventListener('input', (e) => {
        const term = e.target.value.trim().toLowerCase();
        const cards = document.querySelectorAll('.school-card');
        cards.forEach(card => {
          const text = card.innerText.toLowerCase();
          card.style.display = text.includes(term) ? 'block' : 'none';
        });
      });

      // Ø²Ø± ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù…ÙˆÙ‚Ø¹
      document.getElementById('useLocationBtn').addEventListener('click', locateUser);

      // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
      window.onload = function() {
        initMap();
        // Ù…ÙˆÙ‚Ø¹ Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù…Ø¤Ù‚Øª
        setTimeout(() => {
          if (!userLocation) {
            setUserLocation(36.775, 3.060);
          }
        }, 500);
      };
    })();
  </script>
</body>
</html>
